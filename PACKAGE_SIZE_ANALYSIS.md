# 打包大小分析

## 📦 当前打包大小

- **总大小**: 约 240MB（_internal 目录）
- **可执行文件**: 约 4MB
- **应用总大小**: 约 170MB（压缩后 DMG 约 35MB）

## 🔍 空间占用分析

### 主要占用（约 200MB，占 83%）

| 库/组件 | 大小 | 说明 |
|---------|------|------|
| **cv2 (OpenCV)** | 89MB | 图像处理库，包含大量图像算法 |
| **ddddocr** | 84MB | OCR 库，包含 3 个 ONNX 模型文件 |
| **onnxruntime** | 27MB | ONNX 模型运行时库 |

### OCR 模型文件详情

| 文件 | 大小 | 用途 |
|------|------|------|
| `common.onnx` | 52MB | 主要 OCR 识别模型 |
| `common_det.onnx` | 19MB | 文字检测模型 |
| `common_old.onnx` | 13MB | 旧版兼容模型 |

### 其他依赖（约 40MB，占 17%）

- **Python 解释器**: 6.4MB + 6.4MB (framework)
- **numpy**: 6.6MB - 数值计算
- **PIL**: 7.9MB - 图像处理
- **cryptography**: 10MB - 加密库
- **其他库**: 约 10MB

## ❓ 为什么这么大？

### 1. OCR 功能需要机器学习模型

- **ddddocr** 使用深度学习模型进行验证码识别
- ONNX 模型文件包含训练好的神经网络权重
- 3 个模型文件共 84MB，这是 OCR 准确性的基础

### 2. OpenCV 是完整的图像处理库

- **cv2** 包含数百个图像处理算法
- 支持多种图像格式和操作
- 虽然我们只用一小部分功能，但库是完整的

### 3. Python 解释器和依赖

- Python 3.9 解释器本身约 13MB
- 所有依赖库的二进制文件
- 这是独立运行的必要组件

## 🎯 优化方案

### 方案 1：只使用必要的 OCR 模型（推荐）

如果只需要基本的 OCR 功能，可以只保留 `common.onnx`：

```python
# 修改 spiders.py
self.ocr = ddddocr.DdddOcr(show_ad=False, det=False)  # 不使用检测模型
```

**预期减少**: 约 32MB（移除 common_det.onnx 和 common_old.onnx）

### 方案 2：使用更轻量的 OCR 方案

替换 ddddocr 为更轻量的 OCR 库：

- **pytesseract**: 约 5MB（但准确率可能下降）
- **easyocr**: 约 50MB（但功能更强大）

**预期减少**: 约 60-80MB

### 方案 3：使用系统 Python（不打包环境）

如果目标用户都有 Python 环境：

- 只打包脚本文件（几 KB）
- 用户自行安装依赖

**预期减少**: 约 240MB（但需要用户安装环境）

### 方案 4：使用 UPX 压缩（实验性）

使用 UPX 压缩可执行文件：

```bash
pyinstaller --upx-dir=/path/to/upx ...
```

**预期减少**: 约 20-30%（但可能影响启动速度）

### 方案 5：接受当前大小（推荐）

**理由**：
- OCR 功能需要这些模型文件
- 170MB 对于桌面应用来说是可以接受的
- 完全独立，用户体验好
- 不需要用户安装任何依赖

## 📊 对比其他应用

| 应用类型 | 典型大小 |
|---------|---------|
| Electron 应用 | 100-300MB |
| 带 OCR 的桌面应用 | 150-250MB |
| 我们的应用 | 170MB ✅ |

## ✅ 建议

**保持当前方案**，因为：

1. ✅ **功能完整**: 包含所有必要的 OCR 模型
2. ✅ **完全独立**: 用户无需安装任何依赖
3. ✅ **大小合理**: 170MB 在可接受范围内
4. ✅ **性能优先**: 不压缩可以保证启动速度

如果确实需要减小体积，可以尝试**方案 1**（移除不必要的 OCR 模型），但可能会影响识别准确率。

## 🔧 如何优化（如果必须）

### 步骤 1：检查是否真的需要所有模型

```python
# 测试只使用 common.onnx
ocr = ddddocr.DdddOcr(show_ad=False, det=False)
# 测试识别准确率
```

### 步骤 2：修改 PyInstaller 配置

创建 `spider_bin.spec` 文件，排除不必要的文件：

```python
# 在 Analysis 中添加 excludes
excludes=['common_old.onnx', 'common_det.onnx']
```

### 步骤 3：重新打包

```bash
pyinstaller spider_bin.spec
```

---

**总结**: 当前打包大小是合理的，主要因为 OCR 功能需要机器学习模型。如果必须优化，建议只移除不必要的 OCR 模型文件。

